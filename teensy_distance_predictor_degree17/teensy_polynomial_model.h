/*
 * Teensy 4.1 Polynomial Regression Model (Degree 17) - Double Precision
 * Auto-generated from: models/20250721_233056/polynomial_degree17_mae0.90.joblib
 * Generated on: 2025-07-27 15:45:01
 * 
 * Model Information:
 * - Polynomial Degree: 17
 * - Feature Count: 171
 * - Input Features: 2 (under_y, theta)
 * - Training MAE: 0.239984
 * - Validation MAE: 0.900133
 * 
 * Precision: Double precision (64-bit) for extreme value handling
 */

#ifndef TEENSY_POLYNOMIAL_MODEL_H
#define TEENSY_POLYNOMIAL_MODEL_H

#include <Arduino.h>

// Model metadata constants
const int POLY_DEGREE = 17;
const int FEATURE_COUNT = 171;
const int INPUT_FEATURES = 2;

// Use double precision for critical calculations to match PC precision
#define USE_DOUBLE_PRECISION 1

// Model coefficients (stored in Flash memory as double precision)
const double MODEL_COEFFICIENTS[FEATURE_COUNT] PROGMEM = {
      1.988765567298e+03,  -8.908337042422e+01,  -3.914992005999e+00,   1.010355533849e+03,
     -1.137322208843e+02,   5.604585617965e+00,  -3.086525318328e+04,   2.123998239843e+03,
     -1.067225229978e+02,   1.287317429633e+01,   3.509592907307e+05,  -2.780999143810e+04,
      1.026227970105e+04,   1.848434011690e+03,   4.207022165515e+01,  -2.016629726262e+06,
      2.821572438217e+05,  -1.221069465364e+05,  -2.458215936737e+04,  -1.036615598147e+03,
     -4.114108283226e+02,   6.587915809176e+06,  -1.933353224798e+06,   4.456013357884e+05,
      1.005656219482e+05,  -1.550134136624e+04,  -5.700892301428e+03,  -4.815271259750e+02,
     -1.203986109375e+07,   8.648637837970e+06,   1.131571000882e+06,   1.672843244120e+05,
      5.151761611722e+05,   1.285840161141e+05,   6.474866816084e+03,   2.593597888944e+03,
      9.004544353260e+06,  -2.548229223321e+07,  -1.613871280718e+07,  -3.047050356700e+06,
     -5.357882342435e+06,  -1.002176265935e+06,  -6.985250773675e+04,  -3.631027560303e+03,
      2.475047646658e+03,   7.427158559332e+06,   4.930905991345e+07,   6.598344596060e+07,
      1.271362514645e+07,   3.024664865347e+07,   4.153987223981e+06,   5.794311408055e+05,
     -1.354123901051e+05,  -1.566915163313e+04,  -8.244949207354e+03,  -1.922630869666e+07,
     -5.953259262912e+07,  -1.468138669983e+08,  -2.820457826328e+07,  -1.072486959456e+08,
     -1.054053432659e+07,  -2.832281376433e+06,   1.326670530138e+06,   5.439868627143e+04,
      3.538492069041e+04,  -6.217450286423e+03,   5.196915955698e+06,   3.518894702106e+07,
      1.857407143260e+08,   3.484486396274e+07,   2.549637814106e+08,   1.759791593999e+07,
      8.441299708084e+06,  -5.786831371096e+06,  -2.953107699776e+05,  -8.908104946310e+04,
      2.911867413882e+04,   1.505665090466e+04,   1.668570780604e+07,   1.050040582066e+07,
     -9.966178318018e+07,  -1.608740888199e+07,  -4.182682368883e+08,  -2.032740558329e+07,
     -1.679916157206e+07,   1.476616286630e+07,   1.597749967172e+06,  -7.000066666251e+04,
     -4.890223783403e+04,  -4.808594667955e+04,   7.552728922809e+03,  -1.159779551808e+07,
     -3.748355080155e+07,  -6.623458010410e+07,  -1.861623567809e+07,   4.757777702243e+08,
      1.717192950636e+07,   2.368152663965e+07,  -2.403918377052e+07,  -4.629957994987e+06,
      8.700880778276e+05,  -1.028185820513e+05,   1.528150716414e+05,  -2.798042774312e+04,
     -1.525299998981e+04,  -1.191754860853e+07,   3.031817478138e+07,   1.604611858393e+08,
      3.781359082169e+07,  -3.687725293908e+08,  -1.134027586725e+07,  -2.375959245018e+07,
      2.547594906417e+07,   7.254501836816e+06,  -1.899768357915e+06,   5.022217716008e+05,
     -3.368940718199e+05,   6.343859295908e+04,   2.477965346795e+04,  -3.563320636916e+03,
      2.004887349532e+07,  -1.148653805457e+07,  -1.250811217026e+08,  -2.911574665274e+07,
      1.858084198777e+08,   5.966054696004e+06,   1.607079379583e+07,  -1.709782897387e+07,
     -6.327531312421e+06,   1.976102220620e+06,  -7.055181387648e+05,   3.861319679909e+05,
     -9.992301968171e+04,  -7.783545547330e+03,   1.153772768861e+04,   6.627845659167e+03,
     -1.045129977677e+07,   1.641487007830e+06,   4.777550571588e+07,   1.126194929496e+07,
     -5.483226684369e+07,  -2.197250694013e+06,  -6.482811890169e+06,   6.621061093453e+06,
      2.921270632787e+06,  -1.036235379235e+06,   4.224228867905e+05,  -2.159124131169e+05,
      8.851823412859e+04,  -2.314477436925e+03,  -1.372240173621e+04,  -1.198301847881e+04,
     -5.357223002659e+01,   1.977291905037e+06,   5.525923880977e+04,  -7.496012033553e+06,
     -1.808129624761e+06,   7.184305830207e+06,   3.952454294637e+05,   1.164690532061e+06,
     -1.129465375820e+06,  -5.621352862316e+05,   2.216948042732e+05,  -8.965950326874e+04,
      4.670270140122e+04,  -3.266339116460e+04,   1.108498341994e+03,   6.626369301230e+03,
      4.806863600281e+03,  -2.399948494537e+02,   2.055721946866e+02
};

// Model intercept (double precision)
const double MODEL_INTERCEPT = 2.754938017587604e+01;

// StandardScaler mean values (stored in Flash memory as double precision)
const double SCALER_MEAN[FEATURE_COUNT] PROGMEM = {
      1.000000000000e+00,   6.050000000000e+01,   2.695832218750e+00,   4.900500000000e+03,
      1.743028103437e+02,   5.413365356223e+02,   4.465505000000e+05,   1.471136651772e+04,
      3.737040083735e+04,   4.485158582524e+03,   4.340372850000e+07,   1.378128615380e+06,
      3.277185914052e+06,   3.298262611373e+05,   5.748231956654e+05,   4.394503470500e+09,
      1.366249831246e+08,   3.148256949301e+08,   2.995634938927e+07,   4.486866687149e+07,
      8.058281044383e+06,   4.576406461605e+11,   1.403921487288e+10,   3.177372869076e+10,
      2.943834664397e+09,   4.206297768355e+09,   6.646081821123e+08,   7.935508746084e+08,
      4.865099866479e+13,   1.478935504258e+12,   3.308912535931e+12,   3.019119070488e+11,
      4.218269433366e+11,   6.408914342966e+10,   6.878935283182e+10,   1.562992456380e+10,
      5.254070571900e+15,   1.586725172258e+14,   3.522133551869e+14,   3.182138079364e+13,
      4.388658772162e+13,   6.543950809895e+12,   6.800715458751e+12,   1.416059892878e+12,
      1.295818354554e+12,   5.745034282837e+17,   1.726474783315e+16,   3.810427015983e+16,
      3.419121181151e+15,   4.675806806313e+15,   6.895868200044e+14,   7.055333129716e+14,
      1.430770246884e+14,   1.220085804130e+14,   3.250282372036e+13,   6.345293300351e+19,
      1.899608215815e+18,   4.174412461520e+18,   3.727002289433e+17,   5.066717445024e+17,
      7.418439358913e+16,   7.519715588024e+16,   1.505257128927e+16,   1.256290497759e+16,
      3.163273266648e+15,   2.391515803626e+15,   7.066631601074e+21,   2.109161789809e+20,
      4.619271716966e+20,   4.108462200987e+19,   5.560863942735e+19,   8.100189129210e+18,
      8.159900814234e+18,   1.620601799311e+18,   1.338033751097e+18,   3.310818727845e+17,
      2.393831684545e+17,   7.168164143546e+16,   7.924962291372e+23,   2.359542117768e+22,
      5.153680948739e+22,   4.570039968901e+21,   6.164803482558e+21,   8.945484087790e+20,
      8.971275426660e+20,   1.772257493428e+20,   1.453524515443e+20,   3.564456664528e+19,
      2.541052180405e+19,   7.346902553465e+18,   4.839146604027e+18,   8.940399581441e+25,
      2.656478088493e+24,   5.789454398980e+24,   5.121420778381e+23,   6.890175683562e+23,
      9.968289536518e+22,   9.963372767863e+22,   1.960609536782e+22,   1.600627613250e+22,
      3.903045835917e+21,   2.761715295949e+21,   7.894018504284e+20,   5.059025363161e+20,
      1.657115127757e+20,   1.013761196473e+28,   3.007087503699e+26,   6.541560276974e+26,
      5.775262323416e+25,   7.753024487001e+25,   1.118994702826e+25,   1.115493031655e+25,
      2.188581761893e+24,   1.780693691355e+24,   4.324930789160e+23,   3.045525686845e+23,
      8.651118916994e+22,   5.492978980171e+22,   1.761282718539e+22,   1.049751864265e+22,
      1.154639597329e+30,   3.420024343714e+28,   7.428368495416e+28,   6.547315419899e+27,
      8.773746492695e+27,   1.263856280255e+27,   1.257225670850e+27,   2.460879620182e+26,
      1.997007486121e+26,   4.835939804031e+25,   3.393684434248e+25,   9.600507920112e+24,
      6.064006142180e+24,   1.929741028580e+24,   1.131228936495e+24,   3.974536033641e+23,
      1.320245101785e+32,   3.905693345479e+30,   8.472072275123e+30,   7.456739402220e+29,
      9.977399971434e+29,   1.434919083019e+29,   1.424896495583e+29,   2.783771800850e+28,
      2.254320250566e+28,   5.446413912943e+27,   3.812149122002e+27,   1.075215260917e+27,
      6.767494009398e+26,   2.144156042469e+26,   1.249182516802e+26,   4.332647405427e+25,
      2.400924036706e+25,   1.514835894630e+34,   4.476529164287e+32,   9.699263909654e+32,
      8.526573585767e+31,   1.139426910605e+32,   1.636450204011e+31,   1.622641406807e+31,
      3.165102500597e+30,   2.558747688185e+30,   6.170383754398e+29,   4.310011329043e+29,
      1.212850909761e+29,   7.613915679329e+28,   2.405004436105e+28,   1.395946374008e+28,
      4.817174685446e+27,   2.642661031887e+27,   9.810215044775e+26
};

// StandardScaler scale values (stored in Flash memory as double precision)
const double SCALER_SCALE[FEATURE_COUNT] PROGMEM = {
      1.000000000000e+00,   3.521718330588e+01,   2.310993345448e+01,   4.403274718888e+03,
      1.801889132094e+03,   5.308276093665e+02,   5.081666036942e+05,   1.776437569574e+05,
      5.300708357956e+04,   2.781068548414e+04,   5.805331105284e+07,   1.871668017321e+07,
      5.757311890663e+06,   2.586876513523e+06,   9.825460031361e+05,   6.643889843403e+09,
      2.038564709669e+09,   6.384015400312e+08,   2.725798470385e+08,   1.027117700693e+08,
      4.823463392870e+07,   7.635844865626e+11,   2.265826779194e+11,   7.179995576352e+10,
      2.980706929798e+10,   1.129865083221e+10,   4.996880803893e+09,   2.051687991249e+09,
      8.815153029672e+13,   2.553367927800e+13,   8.159739131833e+12,   3.326226017114e+12,
      1.265999889901e+12,   5.481287717124e+11,   2.240486883217e+11,   1.012582051035e+11,
      1.021857390265e+16,   2.906354298326e+15,   9.347115863042e+14,   3.761343500436e+14,
      1.435868027495e+14,   6.139483553035e+13,   2.510975249159e+13,   1.108661472497e+13,
      4.725473009029e+12,   1.188875316183e+18,   3.333445375495e+17,   1.077437286685e+17,
      4.293915570781e+16,   1.642924236752e+16,   6.965312749182e+15,   2.850173084356e+15,
      1.245958907767e+15,   5.298034047455e+14,   2.369248339870e+14,   1.387626112032e+20,
      3.846313312858e+19,   1.248230008046e+19,   4.937178744392e+18,   1.892505301414e+18,
      7.973510910240e+17,   3.264160824102e+17,   1.417870332813e+17,   6.024321975323e+16,
      2.668024172790e+16,   1.161431442553e+16,   1.624148544326e+22,   4.459677896592e+21,
      1.452108452885e+21,   5.708890915161e+20,   2.191610160702e+20,   9.189416344076e+19,
      3.763397165077e+19,   1.627291813985e+19,   6.910474547196e+18,   3.044762226405e+18,
      1.323310834733e+18,   5.910858119258e+17,   1.905670061305e+24,   5.191614130921e+23,
      1.695168150000e+23,   6.631370004226e+22,   2.548962291053e+22,   1.064691305609e+22,
      4.361826202151e+21,   1.879530029873e+21,   7.978732533657e+20,   3.502915065004e+20,
      1.520857696317e+20,   6.762107498814e+19,   2.981190105347e+19,   2.240847430882e+26,
      6.064049653248e+25,   1.984765149560e+25,   7.731965474190e+24,   2.975213993239e+24,
      1.238845677115e+24,   5.076905623561e+23,   2.181675336140e+23,   9.258991607595e+22,
      4.054125322425e+22,   1.758822511173e+22,   7.797260721678e+21,   3.433261165442e+21,
      1.535873310113e+21,   2.640052638806e+28,   7.103428999624e+27,   2.329747572723e+27,
      9.043818582556e+26,   3.483252109760e+26,   1.446597901984e+26,   5.929984681553e+25,
      2.542588852542e+25,   1.078871761396e+25,   4.714010713221e+24,   2.043909608488e+24,
      9.041471134734e+23,   3.977248636489e+23,   1.774751305744e+23,   7.886737085060e+22,
      3.115715124936e+30,   8.341548669220e+29,   2.740740265737e+29,   1.060687321873e+29,
      4.088596282884e+28,   1.694234452356e+28,   6.946905648555e+27,   2.973091662403e+27,
      1.261372907771e+27,   5.502048024218e+26,   2.384501466807e+26,   1.053025496201e+26,
      4.628655103319e+25,   2.061662002786e+25,   9.152435305209e+24,   4.102657986773e+24,
      3.682732568755e+32,   9.816582037246e+31,   3.230490800924e+31,   1.246914316166e+31,
      4.809894505770e+30,   1.989328119396e+30,   8.158798362297e+29,   3.486271141923e+29,
      1.478948108518e+29,   6.441987258667e+28,   2.790840398609e+28,   1.230782429727e+28,
      5.406761096376e+27,   2.404823675837e+27,   1.066700820393e+27,   4.774101193042e+26,
      2.132611844339e+26,   4.358964458945e+34,   1.157432401057e+34,   3.814287780697e+33,
      1.468826502590e+33,   5.669528480403e+32,   2.340979342098e+32,   9.603073104522e+31,
      4.097885234447e+31,   1.738277042040e+31,   7.562529372640e+30,   3.275317430258e+30,
      1.442801767355e+30,   6.335071351937e+29,   2.814490784192e+29,   1.247584319233e+29,
      5.576837994351e+28,   2.489142305678e+28,   1.117910341917e+28
};

// Function prototypes for Teensy 4.1 optimized prediction pipeline (Double precision only)
float predict_distance_teensy(float under_y, float theta);
void generate_polynomial_features_double(float under_y, float theta, double* features);
void apply_standard_scaling_double(double* features);
double compute_linear_combination_double(const double* features);

// Utility functions for debugging and testing
void print_model_info();
void print_feature_values_double(const double* features);
bool validate_input_range(float under_y, float theta);

// Memory and performance optimization macros
#define TEENSY_INLINE __attribute__((always_inline)) inline
#define TEENSY_FAST __attribute__((optimize("O2")))

// Input validation constants
const float UNDER_Y_MIN = -100.0f;
const float UNDER_Y_MAX = 100.0f;
const float THETA_MIN = -180.0f;
const float THETA_MAX = 180.0f;

#endif // TEENSY_POLYNOMIAL_MODEL_H
